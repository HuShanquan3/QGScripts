!(function (e) { var t = {COMMENT_CONFIG: {cssURL: '//css.ykimg.com/youku/dist/css/find/play/comment_open.css', libURL: '//js.ykimg.com/youku/dist/js/lib.js', jsURL: '//js.ykimg.com/youku/dist/js/page/comment/comment_open.js'}, COMMENT_CONFIG_TEST: {cssURL: '//csstest.ykimg.com/youku/dist/css/find/play/comment_open.css', libURL: '//js.ykimg.com/youku/dist/js/lib.js', jsURL: '//jstest.ykimg.com/youku/dist/js/page/comment/comment_open.js'}}; var n = {COMMENT_CONFIG: {cssURL: ['//g.alicdn.com/static-es6/comment/0.0.11/static/css/phone.css'], jsURL: '//g.alicdn.com/static-es6/comment/0.0.11/static/js/phone.js'}, COMMENT_CONFIG_TEST: {cssURL: ['//g.alicdn.com/static-es6/comment/0.0.11/static/css/phone.css'], jsURL: '//g.alicdn.com/static-es6/comment/0.0.11/static/js/phone.js'}}; function i (e) { e = e || {}; if (e.el) { this.el = e.el.nodeName ? e.el : document.getElementById(e.el); this.create().initFrame() } }i.prototype.create = function () { var e = this.iframe = document.createElement('iframe'); e.id = 'comment-frame'; e.src = 'about:blank'; e.frameBorder = 0; e.style.width = '100%'; e.style.height = '100%'; this.el && this.el.appendChild(e); this.win = e.contentWindow; return this }; i.prototype.initFrame = function () { var e; try { e = this.win.document; e.open() } catch (t) { this.iframe.src = "javascript:void((function(){document.open();document.domain='" + document.domain + "';})())"; e = this.win.document }e.write('<!doctype html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"></head><body><div id="root"></div></body></html>'); e.close(); this.frameRootId = 'root'; this.frameRoot = e.getElementById('root'); return this }; i.prototype.addStyle = function (e) { if (!e) return; var t = this.win.document; var n = [].concat(e); var i; var r = document.createDocumentFragment(); while (i = n.shift()) { var o = document.createElement('link'); o.rel = 'stylesheet'; o.type = 'text/css'; o.href = i; r.appendChild(o); o = null }(t.head || t.getElementsByTagName('head')[0]).appendChild(r); r = null; return this }; i.prototype.addScript = function (e, t, n) { if (!e) return; var i = this.win.document; var r = document.createElement('script'); if (t)r.id = t; if (n)r.onload = r.onreadystatechange = function (e, t) { if (t || !r.readyState || /loaded|complete/.test(r.readyState)) { r.onload = r.onreadystatechange = null; r = null; if (!t)n() } }; r.charset = 'utf-8'; r.src = e; i.body.insertBefore(r, this.frameRoot); return this }; i.prototype.addMeta = function (e, t) { var n = this.win.document; var i = document.createElement('meta'); i.charset = 'utf-8'; i.name = e; i.content = t; (n.head || n.getElementsByTagName('head')[0]).appendChild(i); i = null; return this }; i.prototype.resize = function (e, t) { if (e) this.el.style.width = e + 'px'; if (t) this.el.style.height = t + 'px'; return this }; var r = []; var o = null; i.prototype.trigger = function (e, t) { !(function (e, t) { r.push(function () { o.trigger(e, t) }) }(e, t)); if (!o) return; var n; while (n = r.shift())n() }; e.ykComment = function (r, s) { var c = a(); var l = new i({el: document.getElementById(r)}); var d = c ? t : n; d = s.isTest === true ? d.COMMENT_CONFIG_TEST : d.COMMENT_CONFIG; c ? l.addStyle(d.cssURL).addScript(d.libURL, 'libjsnode', function () { l.addScript(d.jsURL, null, function () { l.win.oz.require(['page/comment/comment_open'], function (e) { o = e; s.el = '#' + l.frameRootId; e.init(s); if (s.autoIframeHeight) { var t = l.iframe.style.height; l.iframe.scrolling = 'no'; setInterval(function () { var e = (l.win.document.body.clientHeight || l.win.document.documentElement.clientHeight) + 'px'; if (t != e)l.iframe.style.height = t = e }, 500) } }) }) }) : l.addMeta('viewport', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no').addStyle(d.cssURL).addScript(d.jsURL, null, function () { try { u('//cmstool.youku.com/cms/player/userinfo/user_info', function (t) { e.USER_INFO = t; l.win.ykComment(l.frameRootId, s); if (s.autoIframeHeight) { l.iframe.scrolling = 'no'; e.addEventListener('message', function (e) { if (e.data.height)l.iframe.style.height = e.data.height + 'px' }, false) } }) } catch (t) { console.log(JSON.stringify(t)) } }); return l }; function a () { var e = navigator.userAgent; if (e.match(/Android/i) || e.match(/webOS/i) || e.match(/iPhone/i) || e.match(/iPad/i) || e.match(/iPod/i) || e.match(/BlackBerry/i) || e.match(/Windows Phone/i)) return false; else return true } var s = 0; function c () {} function u (e, t, n) { if (typeof t === 'function') { n = t; t = null } if (t)e += (e.indexOf('?') == -1 ? '?' : '&') + d(t); return l(e, {param: 'callback', timeout: 5e3}, n) } function l (t, n, i) { if (typeof n === 'function') { i = n; n = {} } if (!n)n = {}; var r = n.prefix || '__jp'; var o = n.name || r + s++; var a = n.param || 'callback'; var u = n.timeout != null ? n.timeout : 6e4; var l = encodeURIComponent; var d = document.getElementsByTagName('script')[0] || document.head; var f; var p; if (u)p = setTimeout(function () { h(); if (i)i(new Error('Timeout')) }, u); function h () { if (f.parentNode)f.parentNode.removeChild(f); e[o] = c; if (p)clearTimeout(p) } function m () { if (e[o])h() }e[o] = function (e) { h(); if (i)i.call(null, e) }; t += (~t.indexOf('?') ? '&' : '?') + a + '=' + l(o); t = t.replace('?&', '?'); f = document.createElement('script'); f.src = t; d.parentNode.insertBefore(f, d); return m } function d (e) { var t = []; for (var n in e) if (e[n] !== '')t.push(encodeURIComponent(n) + '=' + encodeURIComponent(e[n])); return t.join('&') } }(window))